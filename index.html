<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Love Game ‚Äî For My Bestie ‚ù§Ô∏è</title>
<style>
  :root{
    --bg:#06060b; --accent:#ff4d6d; --soft:#ff9bb3; --white:#fff;
  }
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--white); -webkit-font-smoothing:antialiased;}
  /* Starry background */
  .stars{position:fixed;inset:0;z-index:-10;overflow:hidden;background:radial-gradient(ellipse at bottom, rgba(10,10,20,0.7) 0%, rgba(5,5,12,1) 60%);}
  .star{position:absolute;width:2px;height:2px;background:rgba(255,255,255,0.9);border-radius:50%;opacity:0.9;box-shadow:0 0 6px rgba(255,255,255,0.85);}
  /* falling tiny glowing hearts (decor) */
  .falling{position:fixed;inset:0;pointer-events:none;z-index:-5;}
  .fheart{position:absolute;font-size:18px;opacity:0.9;filter:drop-shadow(0 6px 8px rgba(255,20,100,0.2));}
  /* Center area */
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;box-sizing:border-box;flex-direction:column;gap:18px}
  .card{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:18px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.6);backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,0.03)}
  h1{margin:0;font-size:20px;letter-spacing:0.2px}
  p.small{margin:6px 0 0 0;font-size:13px;opacity:0.8}
  /* Play button */
  .playBtn{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;background:linear-gradient(90deg,var(--accent),#ff7a88);border-radius:999px;color:white;font-weight:600;border:none;cursor:pointer;font-size:16px;box-shadow:0 8px 30px rgba(255,77,109,0.18)}
  .playBtn:active{transform:scale(.98)}
  /* Tree area */
  .stage{display:flex;gap:20px;align-items:flex-start;justify-content:center;padding:24px 10px}
  .tree-wrap{position:relative;width:420px;max-width:86vw;height:520px;display:flex;align-items:center;justify-content:center}
  svg.tree-svg{width:100%;height:100%;overflow:visible}
  /* Draw animation for trunk/branches */
  .path-anim{stroke-linecap:round;stroke-linejoin:round;stroke-width:6;stroke:#2d1e10;fill:none;stroke-dasharray:1000;stroke-dashoffset:1000;animation:draw 2s ease forwards}
  @keyframes draw{to{stroke-dashoffset:0}}
  /* Hearts as leaf nodes */
  .node-heart{cursor:pointer;font-size:26px;transform-origin:center;transition:transform .22s ease, filter .2s, opacity .25s}
  .node-heart:hover{transform:scale(1.18)}
  /* falling hearts from tree (larger) */
  .falling-large{position:absolute;left:0;top:0;pointer-events:none}
  /* Questions modal */
  .modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:420px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:18px;border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,0.6);z-index:40;border:1px solid rgba(255,255,255,0.04)}
  .qtxt{font-weight:700;font-size:16px;margin-bottom:10px}
  .opts{display:flex;gap:10px;flex-wrap:wrap}
  .opt{flex:1;min-width:120px;text-align:center;padding:10px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.02);cursor:pointer;user-select:none}
  .opt.primary{background:linear-gradient(90deg,var(--accent),#ff7a88);color:white;border:none}
  .opt.disabled{opacity:.6;transform:translateY(0);animation:shake 0.6s;pointer-events:none}
  @keyframes shake{10%{transform:translateX(-6px)}30%{transform:translateX(6px)}50%{transform:translateX(-4px)}70%{transform:translateX(4px)}90%{transform:translateX(0)}}
  /* Burning heart effect (brief) */
  .burn-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:80;pointer-events:none}
  .burn-heart{font-size:110px;animation:burnpop 2.2s ease forwards}
  @keyframes burnpop{0%{opacity:1;transform:scale(0.6) rotate(-10deg);filter:drop-shadow(0 0 20px rgba(255,60,120,0.6))}50%{transform:scale(1.05) rotate(6deg);filter:blur(0px)}100%{opacity:0;transform:scale(3) rotate(30deg);filter:blur(6px)}}
  /* Large image reveal */
  .reveal{display:flex;flex-direction:column;align-items:center;gap:14px;justify-content:center;padding:10px}
  .big-pic{width:86vw;max-width:520px;height:auto;border-radius:14px;object-fit:cover;box-shadow:0 20px 60px rgba(0,0,0,0.6);transform-origin:center;transition:transform .45s ease,opacity .4s}
  .side-pics{display:flex;gap:18px;flex-wrap:nowrap;justify-content:center;align-items:center;transform:translateY(30px);opacity:0;transition:all .6s ease}
  .side-pics img{width:38vw;max-width:280px;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,0.6)}
  .love-line{font-size:18px;color:var(--soft);text-align:center;text-shadow:0 0 20px rgba(255,0,80,0.15)}
  /* small helper & responsive */
  .muted{opacity:.7;font-size:13px}
  @media (max-width:600px){
    .tree-wrap{height:420px}
    .node-heart{font-size:22px}
    .big-pic{max-width:92vw}
    .side-pics img{width:44vw}
  }
</style>
</head>
<body>

<div class="stars" id="stars"></div>
<div class="falling" id="falling"></div>

<div class="wrap">
  <div class="card" role="main" aria-label="Love Game Card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <div>
        <h1>For my bestie ‚ù§Ô∏è</h1>
        <p class="small muted">Click the heart on the tree and answer ‚Äî a little surprise awaits after you say "Yes"!</p>
      </div>
      <div>
        <button class="playBtn" id="startBtn" title="Play Janemann">‚ñ∂ Play Song (Janemann)</button>
      </div>
    </div>

    <div class="stage" style="margin-top:18px;">
      <div class="tree-wrap" aria-hidden="false" id="treeWrap">
        <!-- SVG tree (draw animation) -->
        <svg class="tree-svg" viewBox="0 0 420 520" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Love tree">
          <!-- trunk + branches -->
          <path id="trunk" class="path-anim" d="M210 500 C210 420 210 420 210 360 C200 320 180 300 160 270
            C140 240 120 210 140 180 C160 150 190 140 220 135
            C255 128 280 140 305 165 C325 185 340 215 360 240
            C380 265 400 300 370 330 C345 355 320 360 300 380" stroke="#2b1609" stroke-width="8" fill="none"/>
          <!-- small branch -->
          <path class="path-anim" d="M210 280 C178 260 148 230 130 200" stroke="#2b1609" stroke-width="6" fill="none"/>

          <!-- nodes where hearts will be placed (positions chosen) -->
          <!-- We'll overlay HTML hearts positioned via JS for easier click control -->
        </svg>

        <!-- Heart nodes (absolute positioned) -->
        <div id="nodeContainer" style="position:absolute;inset:0;pointer-events:none">
          <!-- buttons will be injected by JS -->
        </div>

        <!-- falling big hearts from tree -->
        <div id="fallLarge" class="falling-large" aria-hidden="true"></div>
      </div>
    </div>
  </div>

  <!-- modal for questions -->
  <div id="modal" style="display:none"></div>

  <!-- reveal area after final success -->
  <div id="revealArea" style="display:none" class="card" aria-live="polite">
    <div class="reveal" id="revealContent">
      <img id="bigPic" class="big-pic" src="pic2.jpg" alt="Picture" style="transform:scale(.9);opacity:0" />
      <div class="muted">Tap the picture to see more...</div>
      <div class="side-pics" id="sidePics" style="display:flex">
        <img id="side1" src="pic1.jpg" alt="pic1" style="opacity:0; transform:translateY(10px)">
        <img id="side2" src="pic2.jpg" alt="pic2" style="opacity:0; transform:translateY(10px)">
      </div>
      <div class="love-line" id="finalLine" style="display:none">Your beauty shines brighter than every star, my precious friend ‚ù§Ô∏è</div>
    </div>
  </div>
</div>

<!-- burning overlay -->
<div id="burn" style="display:none" class="burn-overlay"><div class="burn-heart">‚ù§Ô∏èüî•</div></div>

<!-- audio (must be at root named exactly song.mp3) -->
<audio id="audio" src="song.mp3" preload="auto"></audio>

<script>
/* ---------- Helper: create subtle stars ---------- */
(function makeStars(){
  const s = document.getElementById('stars');
  const count = Math.floor(window.innerWidth / 6);
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'star';
    const size = Math.random()*2.2 + .8;
    el.style.width = size + 'px';
    el.style.height = size + 'px';
    el.style.left = Math.random()*100 + '%';
    el.style.top = Math.random()*100 + '%';
    el.style.opacity = Math.random()*0.9 + 0.2;
    s.appendChild(el);
  }
})();

/* ---------- falling decorative hearts ---------- */
(function heartFallLoop(){
  const wrap = document.getElementById('falling');
  function spawn(){
    const el = document.createElement('div');
    el.className = 'fheart';
    el.innerText = '‚ù§Ô∏è';
    const size = Math.random()*14 + 16;
    el.style.fontSize = size + 'px';
    el.style.left = Math.random()*100 + 'vw';
    el.style.top = '-10vh';
    el.style.opacity = Math.random()*0.9 + 0.3;
    el.style.transform = 'rotate(' + (Math.random()*60-30) + 'deg)';
    el.style.transition = 'transform linear '+(4+Math.random()*5)+'s, top linear '+(4+Math.random()*5)+'s, opacity linear '+(4+Math.random()*5)+'s';
    wrap.appendChild(el);
    requestAnimationFrame(()=> {
      el.style.top = '110vh';
      el.style.transform = 'translateY(0) rotate(' + (Math.random()*120-60) + 'deg)';
      el.style.opacity = 0;
    });
    setTimeout(()=> el.remove(), 9500);
  }
  setInterval(spawn, 700);
})();

/* ---------- build 4 heart nodes and animation ---------- */
const nodeConfig = [
  {id:'n1', x:225, y:115},
  {id:'n2', x:150, y:170},
  {id:'n3', x:285, y:200},
  {id:'n4', x:200, y:245}
];
const nodeContainer = document.getElementById('nodeContainer');
nodeConfig.forEach((n,i)=>{
  const btn = document.createElement('div');
  btn.className = 'node-heart';
  btn.dataset.idx = i;
  btn.style.position = 'absolute';
  // position relative to svg viewBox 420x520 -> scale to container
  btn.style.left = (n.x/420*100)+'%';
  btn.style.top = (n.y/520*100)+'%';
  btn.style.pointerEvents = 'auto';
  btn.style.transform = 'translate(-50%,-50%)';
  btn.innerHTML = '‚ù§Ô∏è';
  btn.style.filter = 'drop-shadow(0 8px 12px rgba(255,20,100,0.12))';
  nodeContainer.appendChild(btn);
});

/* ---------- tree draw sequence (play trunk animation then show nodes pulse) ---------- */
const trunkPaths = document.querySelectorAll('.path-anim');
setTimeout(()=> trunkPaths.forEach(p => p.style.animationDelay = '0.2s'), 100);

/* ---------- UI flow & Q logic ---------- */
const startBtn = document.getElementById('startBtn');
const audio = document.getElementById('audio');
const nodes = document.querySelectorAll('.node-heart');
const modal = document.getElementById('modal');
const burn = document.getElementById('burn');
const revealArea = document.getElementById('revealArea');
const bigPic = document.getElementById('bigPic');
const sidePics = document.getElementById('sidePics');
const side1 = document.getElementById('side1');
const side2 = document.getElementById('side2');
const finalLine = document.getElementById('finalLine');

let askedCount = 0;      // which question index (0..3)
let answered = [];       // store answers
let currentNode = null;  // which node triggered the modal
let momosChosen = false; // special behavior
let finalUnlocked = false;

/* Questions array (matching user's requested styles) */
const questions = [
  {q:"Why are you so beautiful?", a1:"Because I smile", a2:"Because of you"},
  {q:"Will you sing 'Janemann' for me someday?", a1:"Yes", a2:"No"},
  {q:"Who will you choose ‚Äî momos or me?", a1:"Momos", a2:"You"},
  {q:"I know you're cute ‚Äî will you be my bestie?", a1:"Yes", a2:"No"}
];

/* Show modal helper */
function showModal(nodeIdx){
  currentNode = nodeIdx;
  const item = questions[Math.min(askedCount, questions.length-1)];
  modal.innerHTML = `
    <div class="modal" role="dialog" aria-modal="true">
      <div class="qtxt">${escapeHtml(item.q)}</div>
      <div class="opts">
        <div class="opt opt1">${escapeHtml(item.a1)}</div>
        <div class="opt opt2 primary">${escapeHtml(item.a2)}</div>
      </div>
    </div>
  `;
  modal.style.display = 'block';

  // wire up options
  const opt1 = modal.querySelector('.opt1');
  const opt2 = modal.querySelector('.opt2');

  // special handling for question 3 (momos)
  if(askedCount === 2){
    // if chooses momos -> playful disabled effect
    opt1.addEventListener('click', ()=> {
      // mark momos chosen: animate shake and keep modal open (user must choose other to proceed)
      opt1.classList.add('disabled');
      momosChosen = true;
      setTimeout(()=> opt1.classList.remove('disabled'), 800);
      // small message pop
      showToast("Momos eh? Nice choice... but try the other option too üòâ");
    }, {once:true});
    opt2.addEventListener('click', ()=> {
      // choose 'You' -> proceed normally
      answered.push({q:item.q, ans:item.a2});
      closeModal();
      advanceFlow();
    }, {once:true});
    return;
  }

  // normal handling for other questions
  opt1.addEventListener('click', ()=> {
    answered.push({q:item.q, ans:item.a1});
    closeModal();
    advanceFlow();
  }, {once:true});
  opt2.addEventListener('click', ()=> {
    answered.push({q:item.q, ans:item.a2});
    closeModal();
    advanceFlow();
  }, {once:true});
}

function closeModal(){ modal.style.display='none'; }

/* When a node is clicked show its question (one-time mapping order) */
nodes.forEach(node => {
  node.addEventListener('click', (ev)=>{
    // if this node was already used to ask, ignore
    const idx = parseInt(node.dataset.idx,10);
    // show modal for current question index
    // allow clicking only if askedCount < questions.length and not finalUnlocked
    if(finalUnlocked) return;
    if(askedCount >= questions.length) return;
    showModal(idx);
    // small pop visual on node
    node.animate([{transform:'scale(1.2)'},{transform:'scale(1)'}],{duration:260,easing:'ease-out'});
  });
});

/* Advance after successfully answering one question */
function advanceFlow(){
  askedCount++;
  showToast("Nice answer üòâ");
  // create falling hearts burst when an answer is given
  heartBurst(6);

  if(askedCount >= questions.length){
    // All done ‚Äî unlock final sequence: burning heart then reveal
    finalUnlocked = true;
    setTimeout(()=> runFinalReveal(), 900);
  }
}

/* Play button behavior - show tree nodes visually (pulse) */
startBtn.addEventListener('click', ()=>{
  // allow one click to enable audio play later; start trunk animation already running; just hide button
  startBtn.style.display = 'none';
  // show subtle node indicator (pointer events already enabled)
  document.querySelectorAll('.node-heart').forEach(n=>{
    n.style.opacity = 1;
    n.style.pointerEvents = 'auto';
    n.style.transition = 'transform .6s ease';
    // small entrance animation
    n.animate([{transform:'translateY(-12px) scale(.8)', opacity:0},{transform:'translateY(0) scale(1)', opacity:1}],{duration:700,delay:120});
  });
  // small hint
  showToast("Tap any heart on the tree to answer a question");
});

/* Burning animation + reveal final picture */
function runFinalReveal(){
  // show burning heart overlay (2.2s)
  burn.style.display = 'flex';
  setTimeout(()=> {
    burn.style.display = 'none';
    // show reveal content
    revealArea.style.display = 'block';
    // animate big picture in
    bigPic.style.opacity = 1;
    bigPic.style.transform = 'scale(1)';
    bigPic.animate([{transform:'scale(.9)', opacity:0},{transform:'scale(1)', opacity:1}],{duration:650, easing:'cubic-bezier(.2,.8,.2,1)'});
    // short delay then allow click to expand to side pics and start song
    setTimeout(()=> {
      bigPic.addEventListener('click', showSidePics, {once:true});
      // also autoplay the audio here (user has interacted heavily by now)
      try{ audio.currentTime = 0; audio.play().catch(()=>{}); }catch(e){}
    },600);
  },2200);
}

/* Show the two images side-by-side with animation & reveal final line */
function showSidePics(){
  sidePics.style.opacity = 1;
  sidePics.style.transform = 'translateY(0)';
  // animate each side pic
  side1.style.opacity = 1; side1.style.transform = 'translateY(0)';
  side2.style.opacity = 1; side2.style.transform = 'translateY(0)';
  // show final love line
  setTimeout(()=> {
    finalLine.style.display = 'block';
    finalLine.animate([{opacity:0, transform:'translateY(12px)'},{opacity:1, transform:'translateY(0)'}],{duration:500});
  },420);
}

/* small heart burst function */
function heartBurst(n){
  const container = document.getElementById('fallLarge');
  for(let i=0;i<n;i++){
    const el = document.createElement('div');
    el.style.position='absolute';
    el.style.left = (50 + (Math.random()*120-60)) + 'px';
    el.style.top = (150 + Math.random()*90-40) + 'px';
    el.innerText='‚ù§Ô∏è';
    el.style.fontSize = (12 + Math.random()*18) + 'px';
    el.style.opacity = 1;
    el.style.transition = 'all 1200ms cubic-bezier(.2,.8,.2,1)';
    container.appendChild(el);
    setTimeout(()=> {
      el.style.top = (Math.random()*380 + 220) + 'px';
      el.style.transform = 'translateY(120px) rotate(' + (Math.random()*180-90) + 'deg) scale(.6)';
      el.style.opacity = 0;
    },10);
    setTimeout(()=> el.remove(), 1400);
  }
}

/* small toast */
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.bottom='26px'; t.style.left='50%'; t.style.transform='translateX(-50%)';
  t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.background='linear-gradient(90deg, rgba(255,77,109,0.95), rgba(255,122,136,0.95))';
  t.style.color='white'; t.style.zIndex=90; t.style.boxShadow='0 8px 30px rgba(0,0,0,0.4)';
  document.body.appendChild(t);
  t.animate([{opacity:0, transform:'translateY(6px)'},{opacity:1, transform:'translateY(0)'}],{duration:240});
  setTimeout(()=> {
    t.animate([{opacity:1},{opacity:0, transform:'translateY(10px)'}],{duration:380});
    setTimeout(()=> t.remove(),380);
  },1800);
}

/* escape helper to safely insert text */
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* Accessibility: if audio refused, show small hint to press play */
audio.addEventListener('play', ()=> console.log('audio started'));
audio.addEventListener('error', ()=> console.warn('audio load failed'));

/* Prevent accidental drag on pics */
[bigPic, side1, side2].forEach(img => img && (img.ondragstart = ()=> false));

/* small UX: clicking outside modal closes it (only if not in momos special) */
document.addEventListener('click', (e)=>{
  if(modal.style.display === 'block'){
    const mod = modal.querySelector('.modal');
    if(mod && !mod.contains(e.target)) { /* leave open - require explicit pick */ }
  }
});
</script>
</body>
</html>
